"use strict";var resources={status:{404:"请求出错，网页地址不存在！",401:'很抱歉，你没有权限，如果没有登入可<a class="text-danger" href="/login?returnUrl='+location.href+'">点击登入...<\/a>'},unknownError:"很抱歉，出现了未知错误，请检查是否正确操作后请重试，如果多次出现问题请联系技术支持人员进行排查！",modal:{timeout:"服务器请求超时！",confirm:"确定"},ajax:{notFoundUrl:"操作地址没有配置，请检查a[href],form[action]值！",selectedFirst:"请选择项目后再进行操作！",noHeader:"没有配置RequestVerificationToken验证表单！",mustFormElement:"当前请求的元素必须为form表单元素！",uploading:"上传中..."},alert:{confirm:"确认"},elementError:"元素不存在或者操作一个元素实例，不能获取data-*相关数据！",copy:"复制",copyCode:"复制代码",copied:"复制成功",fullscreen:{show:"全屏显示",quit:"退出全屏"},markdown:{preview:"预览",source:"源码",link:"请输入链接地址",image:"请输入图片地址",upload:"上传图片",title:"标题"}};(function(n){function t(){var t=n("#ajax-protected-form").find('[name="__RequestVerificationToken"]');if(t.length==0)throw new Error(resources.ajax.noHeader);return{RequestVerificationToken:t.val()}}function i(n,t){if(!t||!t(n)){var i=resources.status[n.status];if(i){showMsg(i);return}console.error(n.responseText);showMsg(resources.unknownError)}}n.fn.extend({json:function(n,t){var u,i,r;if(typeof n=="undefined"){if(this.length!==1)throw new Error(resources.elementError);for(u={},i=0;i<this[0].attributes.length;i++)r=this[0].attributes[i],r.name.startsWith("_ajax.")&&(u[r.name.substr(6)]=r.value.trim());return u}return typeof t=="undefined"?this.attr("_ajax."+n):this.attr("_ajax."+n,t)},target:function(){var t=this.attr("_target");return t?t.startsWith(">")?t.find(t.substr(1).trim()):n(t):this},dset:function(n,t){var i=this.data(n);return i||(i=t(),this.data(n,i)),i},exec:function(t,i){return typeof t=="function"&&(i=t,t=undefined),this.each(function(){var r=n(this);t&&r.data(t)||(i(r),t&&r.data(t,!0))})},disabled:function(){return this.attr("disabled","disabled").addClass("disabled")},enabled:function(){return this.removeAttr("disabled").removeClass("disabled")},ajaxSubmit:function(n,t){var u=this,r,i;if(!this.is("form"))throw Error(resources.ajax.mustFormElement);return r=new FormData(this[0]),i=this.find("[type=submit]").disabled(),$ajax(this.attr("action")||location.href,r,function(t){return i.enabled(),n?n.call(u,t):void 0},function(n){i.enabled();t&&t(n)},!1)},loadModal:function(t){var i=this.dset("gt-modal",function(){return n('<div class="modal fade" data-bs-backdrop="static"><div>').appendTo(document.body)}).data("target",this.target()),r=this.attr("href")||this.attr("action"),u=this.json();n.extend(u,t);r=URL.appendQuery(r,u);i.load(r,function(t,u,f){switch(u){case"error":var e=resources.status[f.status];e||(e=resources.unknownError);showMsg(e);return;case"timeout":showMsg(resources.modal.timeout);return}i.find("form").each(function(){var t=n(this),u=t.attr("method")||"get";u.toLowerCase()==="post"?(t.attr("action")||t.attr("action",r),t.find("input[type=file]").length>0&&t.attr("enctype","multipart/form-data"),i.find("[type=submit]").click(function(){t.find(".field-validation-valid").hide();t.find(".modal-validation-summary").remove();t.ajaxSubmit(function(n){var r,u,f,e;if(n.code){if(n.data)for(r in n.data)u=t.find('[data-valmsg-for="'+r+'"]'),u.length==0&&(f=r.charAt(0),f>="a"&&f<="z"&&(e=f.toUpperCase()+r.substr(1),u=t.find('[data-valmsg-for="'+e+'"]'))),u.length&&u.html(n.data[r]).show();n.message&&t.prepend('<div class="alert alert-danger modal-validation-summary"><span class="bi-exclamation-circle"><\/span><span class="summary">'+n.message+"<\/span><\/div>")}else showAlert(n,function(){location.href=location.href}),i.modal("hide");return!0})})):function(){var i=t.find("[type=submit]");i.click(function(){var r=i.attr("formaction");return r+=r.indexOf("?")==-1?"?":"&",r+=t.serialize(),r+="&_="+ +new Date,n.ajax({url:r,method:"GET",success:function(n){i.trigger("success",n);new Function(i.attr("onsuccess")).call(n)},error:function(n){i.trigger("error",n)}}),!1})}()});onrender(i);i.on("hidden.bs.modal",function(){i.remove()}).on("shown.bs.modal",function(){i.data("target").trigger("modal",i)}).modal("show")})}});window.__renders||(window.__renders=[]);window.onrender=function(n){typeof n=="function"?window.__renders.push(n):window.__renders.forEach(function(t){return t(n)})};onrender(function(r){n("[_click]",r).exec("@click",function(r){var u=r.attr("_click").trim().toLowerCase(),f=r.target();if(u==="show"){r.on("click",function(n){n.stopPropagation();f.addClass("d-block");r.trigger("@show",f,n)});n(document).on("click",function(n){f.removeClass("d-block");r.trigger("@hide",f,n)});f.on("click",function(n){n.stopPropagation()})}else if(u==="copy"||u.startsWith("copy:"))r.on("click",function(t){t.preventDefault();n(document).off("copy").on("copy",function(n){var i=u==="copy:html"?f.html():f.text();n.originalEvent.clipboardData.setData("text/plain",i.trim());n.preventDefault();popup(resources.copied,t)});return document.execCommand("copy"),!1});else if(u==="upload")r.off("click").on("click",function(){return n('<input type="file" class="hide"/>').appendTo(document.body).on("change",function(){var f=n(this),e,u,o,s,h;if(!this.files.length)return f.remove(),!1;e=r.html();r.disabled().html('<span class="spinner-border spinner-border-sm"><\/span> '+resources.ajax.uploading);u=new FormData;u.append("file",this.files[0]);o=r.json();for(s in o)u.append(s,o[s]);h=r.attr("href")||r.attr("action");n.ajax({type:"POST",url:h,contentType:!1,processData:!1,data:u,headers:t(),success:function(t){showMsg(t,function(){t.code||t.url||(location.href=location.href)});t.url&&(r.trigger("uploaded",t.url),r.parent().find(".uploaded").each(function(){var i=n(this);i.is("input")?i.val(t.url):i.is("img")&&i.attr("src",t.url)}));f.remove();r.enabled().html(e)},error:function(n){i(n);f.remove();r.enabled().html(e)}})}).click(),!1});else r.on("click",function(t){var i=u.indexOf(":stop"),e,o,s;if(i!==-1&&(t.stopPropagation(),u=u.replace(":stop","")),i=u.indexOf(":prevent"),i!==-1&&(t.preventDefault(),u=u.replace(":prevent","")),e=r.attr("_confirm"),e&&!window.confirm(e))return!1;switch(u){case"modal":return r.loadModal(),!1;case"ajax":return o=r.json(),s=r.attr("href")||r.attr("action"),$ajax(s,o,function(n){n.data||n.message||(location.href=location.href);r.trigger("success",n.data)}),!1;case"checked":return function(){var t=r.json(),n=[],i;r.parents(".data-list").find(".data-item input[type=checkbox]").each(function(){this.checked&&n.push(this.value)});n.length>0&&(t.id=n);i=r.attr("href")||r.attr("action");$ajax(i,t,function(n){n.data||n.message?r.trigger("success",n.data):location.href=location.href})}(),!1;case"checked:modal":case"modal:checked":return function(){var t={},n=[];r.parents(".data-list").find(".data-item input[type=checkbox]").each(function(){this.checked&&n.push(this.value)});n.length>0&&(t.id=n.join(","));r.loadModal(t)}(),!1;case"fullscreen":return n(document.body).hasClass("fullscreen")?(n(document.body).removeClass("fullscreen"),f.removeClass("fullscreen-container").css("height",f.data("_height")),r.attr("title",resources.fullscreen.show).find("i").attr("class","bi-window-fullscreen")):(f.data("_height",f.css("height")),n(document.body).addClass("fullscreen"),f.addClass("fullscreen-container").css("height","100%"),r.attr("title",resources.fullscreen.quit).find("i").attr("class","bi-window-stack")),!1}})});n("[_change]",r).exec("@change",function(n){var t=n.attr("_change").toLowerCase();return n.on("change",function(i){var r=t.indexOf(":stop"),u,f,e;if(r!==-1&&(i.stopPropagation(),t=t.replace(":stop","")),r=t.indexOf(":prevent"),r!==-1&&(i.preventDefault(),t=t.replace(":prevent","")),u=n.attr("_confirm"),u&&!window.confirm(u))return!1;switch(t){case"modal":return n.loadModal(),!1;case"ajax":return f=n.json(),e=n.attr("href")||n.attr("action"),$ajax(e,f,function(t){t.data||t.message||(location.href=location.href);n.trigger("success",t.data)}),!1}})});n("table thead .sorting",r).exec("@click",function(t){return t.on("click",function(){var t=n(this),u="sorting-asc",f,i;t.hasClass("sorting-asc")?(t.json("desc","true"),u="sorting-desc"):t.json("desc","false");t.parent().find(".sorting").removeClass("sorting-asc").removeClass("sorting-desc");f=t.addClass(u).json();i={};n(".toolbar form[method=get]",r).find("input,select,textarea").each(function(){this.value&&(i[this.name]=this.value.trim())});location.href=URL.toSearch(i,f)})});n("form[method=get]",r).exec("@form-get",function(n){n.find("input,select,textarea").each(function(){var n=this.name.toLowerCase(),t=n.indexOf(".");t>0&&(n=n.substr(t+1));this.name=n})});n(".navbar-nav",r).find(".menu-1,.menu-2,.menu-3").exec("@hidden-bs-collapse",function(t){return t.on("hidden.bs.collapse",function(t){t.stopPropagation();n(this).find('a[data-bs-toggle="collapse"]').addClass("collapsed").removeAttr("aria-expanded");n(this).find("div").removeClass("show")})});n(".data-list",r).exec(function(n){var i=n.find(".checked-enabled"),t,r;if(i.length)for(t=n.find(".data-item input[type=checkbox]:not([name])"),n.find("input[type=checkbox]:not([name]").exec("@click-checked",function(n){n.on("click",function(){for(var n=0;n<t.length;n++)if(t[n].checked){i.enabled();return}i.disabled()})}),r=0;r<t.length;r++)if(t[r].checked){i.enabled();return}}),function(t,i){t.split(",").forEach(function(t){return n("[_v"+t+"]",i).exec("@v"+t,function(r){var u=n(r.attr("_v"+t+""),i);if(u.length){u.attr(t,r.val());r.on("change",function(){u.attr(t,this.value)})}})})}("min,max",r);n("form[_ajax=true] [type=submit]",r).exec("@form-ajax-submit",function(n){n.on("click",function(){return n.parents("form").ajaxSubmit(),!1})});n(".card-header.collapse",r).exec("@card-collapse",function(n){n.on("click",function(){if(n.hasClass("show"))return n.toggleClass("show").parents(".card").find(".card-body").toggleClass("hide"),!1;var t=n.parents(".card-root");return t.length&&t.find(".card-header.collapse").removeClass("show").next(".card-body").addClass("hide"),n.addClass("show").parents(".card").find(".card-body").removeClass("hide"),!1})});n("[_event]",r).exec("@event",function(t){t.attr("_event").trim().toLowerCase().split(":").forEach(function(i){switch(i.trim()){case"code":t.find("pre>code").exec(function(t){var i=t.parent();n('<a class="copy" href="javascript:;" title="'+resources.copyCode+'"><i class="bi-clipboard"><\/i><\/a>').prependTo(i).on("click",function(i){i.preventDefault();n(document).off("copy").on("copy",function(n){n.preventDefault();var r=undefined,u=t.find(".hljs-ln-code");u.length?function(){var n=[];u.each(function(){n.push(this.innerText)});r=n.join("\r\n")}():r=t.text();n.originalEvent.clipboardData.setData("text/plain",r);popup(resources.copied,i)});return document.execCommand("copy"),!1})});break;case"noselect":if(t.is("input")||t.is("textarea"))t.on("select",function(){return!1});else t.on("selectstart",function(){return!1})}})})});onrender(function(t){t!==undefined&&n("[data-bs-toggle=dropdown]",t).dropdown()});window.$ajax=function(r,u,f,e,o){typeof u=="undefined"&&(u={});typeof f=="boolean"&&(o=f,f=undefined);typeof e=="boolean"&&(o=e,e=undefined);var s={url:r,data:u,type:"POST",headers:t(),success:function(n){f&&f(n)||showMsg(n,function(){location.href=n.data&&n.data.url?n.data.url:location.href})},error:function(n){i(n,e)}};return o===!1?(s.contentType=!1,s.processData=!1):s.dataType="JSON",n.ajax(s),!1};window.URL||(window.URL={});URL.appendQuery=function(n,t){var i,r;return typeof n=="object"&&(t=n,n="?"),i=n.indexOf("?"),i!==-1?(r=n.substr(i+1),n=n.substr(0,i),t=URL.toSearch(r,t)):t=URL.toSearch(t),n+t};URL.toSearch=function(t,i){var r,u;typeof t=="string"&&(t=URL.parseQuery(t));t||(t={});i&&n.extend(t,i);i="";for(r in t)(u=t[r],u!=="")&&(i.length>0&&(i+="&"),i+=r,i+="=",i+=u);return"?"+i};URL.parseQuery=function(n){for(var u={},i=n.replace(/^\?/,"").split("&"),f=i.length,t=0,r;t<f;t++)i[t]&&(r=i[t].split("="),u[r[0]]=r[1]);return u};URL.parse=function(n){var t=document.createElement("a");return t.href=n,{source:n,protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,params:URL.parseQuery(t.search),file:(t.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:t.hash.replace("#",""),path:t.pathname.replace(/^([^\/])/,"/$1"),relative:(t.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:t.pathname.replace(/^\//,"").split("/")}};window.showMsg=function(t,i,r){if(typeof i=="function"?(r=i,i=-1):typeof i=="undefined"&&(i=-1),typeof t=="object"&&(i=t.code,t=t.message),t){var u=n(document.body).dset("gt-toast",function(){return n('<div style="z-index:100000;" data-bs-delay="1000" class="toast text-white position-fixed top-0 start-50 translate-middle-x"><div class="d-flex"><div class="toast-body"><\/div><\/div><\/div>').appendTo(document.body)});if(i?(t='<span class="bi-exclamation-circle"><\/span> '+t,u.removeClass("bg-success").addClass("bg-danger")):(t='<span class="bi-check-circle"><\/span> '+t,u.removeClass("bg-danger").addClass("bg-success")),u.off("hide.bs.toast").find(".toast-body").html(t),!i&&r)u.on("hide.bs.toast",function(){r()});u.toast("show")}};window.showAlert=function(t,i,r){var f;if(typeof i=="function"?(r=i,i=-1):typeof i=="undefined"&&(i=-1),typeof t=="object"&&(i=t.code,t=t.message),t){var u=n(document.body).dset("gt-alert",function(){return n('<div class="modal fade" data-bs-backdrop="static"><div class="modal-dialog alert-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-body"><div class="icon"><i><\/i><\/div> <div class="msg"><\/div><\/div><div class="modal-footer"><button type="button" class="btn btn-primary"> '+resources.alert.confirm+" <\/button><\/div><\/div><\/div><\/div>").appendTo(document.body)}),e=u.find(".modal-body"),o=i?"danger":"success",s=i?"bi-exclamation-circle":"bi-check-circle";if(e.attr("class","modal-body text-"+o).find("i").attr("class",s),e.find("div.msg").html(t),f=u.find("button").attr("class","btn btn-"+o),!i&&r)f.removeAttr("data-bs-dismiss").on("click",function(){typeof r=="function"?(r(u),u.modal("hide")):location.href=typeof r=="object"?r.url||location.href:location.href});else f.attr("data-bs-dismiss","modal").off("click");u.modal("show")}};window.popup=function(t,i){var r=n('<span class="text-popup"><\/span>').css("color",n(i.target).css("color")).html(t).appendTo(document.body);r.css({left:i.pageX-r.width()/2+"px",top:i.pageY-r.height()/2+"px"});r.on("animationend",function(){r.remove()})};n(function(){onrender()})})(jQuery);