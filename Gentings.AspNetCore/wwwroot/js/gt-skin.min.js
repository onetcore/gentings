"use strict";var resources={status:{404:"请求出错，网页地址不存在！",401:'很抱歉，你没有权限，如果没有登入可<a class="text-danger" href="/login?returnUrl='+location.href+'">点击登入...<\/a>'},unknownError:"很抱歉，出现了未知错误，请检查是否正确操作后请重试，如果多次出现问题请联系技术支持人员进行排查！",modal:{timeout:"服务器请求超时！",confirm:"确定"},ajax:{notFoundUrl:"操作地址没有配置，请检查a[href],form[action]值！",selectedFirst:"请选择项目后再进行操作！",noHeader:"没有配置RequestVerificationToken验证表单！",mustFormElement:"当前请求的元素必须为form表单元素！",uploading:"上传中..."},alert:{confirm:"确认"},elementError:"元素不存在或者操作一个元素实例，不能获取data-*相关数据！",markdown:{fullscreen:{show:"全屏显示",quit:"退出全屏"},preview:"预览",source:"源码",link:"请输入链接地址",image:"请输入图片地址",upload:"上传图片",title:"标题"}};(function(n){function t(){var t=n("#ajax-protected-form").find('[name="__RequestVerificationToken"]');if(t.length==0)throw new Error(resources.ajax.noHeader);return{RequestVerificationToken:t.val()}}function i(n,t){if(!t||!t(n)){var i=resources.status[n.status];if(i){showMsg(i);return}console.error(n.responseText);showMsg(resources.unknownError)}}n.fn.extend({dataAttr:function(n,t){return typeof t=="undefined"?this.attr("data-"+n):this.attr("data-"+n,t)},dataAttrs:function(){var i,n,t;if(this.length!=1)throw new Error(resources.elementError);for(i={},n=0;n<this[0].attributes.length;n++)t=this[0].attributes[n],t.name.startsWith("data-")&&(i[t.name.substr(5)]=t.value.trim());return i},targetElement:function(){var t=this.attr("_target");return t?t.startsWith(">")?t.find(t.substr(1).trim()):n(t):this},dset:function(n,t){var i=this.data(n);return i||(i=t(),this.data(n,i)),i},exec:function(t){return this.each(function(){var i=n(this);i.hasClass("no-js")||t(i)})},disabled:function(){return this.attr("disabled","disabled").addClass("disabled")},enabled:function(){return this.removeAttr("disabled").removeClass("disabled")},ajaxSubmit:function(n,t){var u=this,r,i;if(!this.is("form"))throw Error(resources.ajax.mustFormElement);return r=new FormData(this[0]),i=this.find("[type=submit]").disabled(),$ajax(this.attr("action")||location.href,r,function(t){i.enabled();n&&n.call(u,t)},function(n){i.enabled();t&&t(n)},this.attr("_data-type"))},loadModal:function(t){var i=this.dset("gt-modal",function(){return n('<div class="modal fade" data-bs-backdrop="static"><div>').appendTo(document.body)}).data("target",this.targetElement()),r=this.attr("href")||this.attr("action"),u=this.dataAttrs();n.extend(u,t);r=URL.appendQuery(r,u);i.load(r,function(n,t,u){var e,f;switch(t){case"error":e=resources.status[u.status];e||(e=resources.unknownError);showMsg(e);return;case"timeout":showMsg(resources.modal.timeout);return}f=i.find("form");f.length&&(f.attr("action")||f.attr("action",r),f.find("input[type=file]").length>0&&f.attr("enctype","multipart/form-data"),i.find("[type=submit]").click(function(){f.find(".field-validation-valid").hide();f.find(".modal-validation-summary").remove();f.ajaxSubmit(function(n){var t,r,u,e;if(n.code){if(n.data)for(t in n.data)r=f.find('[data-valmsg-for="'+t+'"]'),r.length==0&&(u=t.charAt(0),u>="a"&&u<="z"&&(e=u.toUpperCase()+t.substr(1),r=f.find('[data-valmsg-for="'+e+'"]'))),r.length&&r.html(n.data[t]).show();n.message&&f.prepend('<div class="alert alert-danger modal-validation-summary"><span class="bi-exclamation-circle"><\/span><span class="summary">'+n.message+"<\/span><\/div>")}else showAlert(n,function(){location.href=location.href}),i.modal("hide");return!0})}));onrender(i);i.on("hidden.bs.modal",function(){i.remove()}).on("shown.bs.modal",function(){i.data("target").trigger("modal",i)}).modal("show")})}});window.__renders||(window.__renders=[]);window.onrender=function(n){typeof n=="function"?window.__renders.push(n):window.__renders.forEach(function(t){return t(n)})};onrender(function(r){n("[_click]",r).each(function(){var r=n(this),u=r.attr("_click").toLowerCase(),f=r.targetElement();if(u==="show"){r.on("click",function(n){n.stopPropagation();f.addClass("d-block");r.trigger("@show",f,n)});n(document).on("click",function(){f.removeClass("d-block");r.trigger("@hide",f,event)});f.on("click",function(n){n.stopPropagation()})}else if(u==="copy")r.on("click",function(t){t.preventDefault();n(document).on("copy",function(n){n.clipboardData.setData("text/plain",f.text().trim());n.preventDefault()});return document.execCommand("copy"),!1});else if(u==="upload")r.off("click").on("click",function(){return n('<input type="file" class="hide"/>').appendTo(document.body).on("change",function(){var f=n(this),e,u,o,s,h;if(!this.files.length)return f.remove(),!1;e=r.html();r.disabled().html('<span class="spinner-border spinner-border-sm"><\/span> '+resources.ajax.uploading);u=new FormData;u.append("file",this.files[0]);o=r.dataAttrs();for(s in o)u.append(s,o[s]);h=r.attr("href")||r.attr("action");n.ajax({type:"POST",url:h,contentType:!1,processData:!1,data:u,headers:t(),success:function(t){showMsg(t,function(){t.code||t.url||(location.href=location.href)});t.url&&(r.trigger("uploaded",t.url),r.parent().find(".uploaded").each(function(){var i=n(this);i.is("input")?i.val(t.url):i.is("img")&&i.attr("src",t.url)}));f.remove();r.enabled().html(e)},error:function(n){i(n);f.remove();r.enabled().html(e)}})}).click(),!1});else r.on("click",function(n){var t=u.indexOf(":stop"),i,f,e;if(t!==-1&&(n.stopPropagation(),u=u.replace(":stop","")),t=u.indexOf(":prevent"),t!==-1&&(n.preventDefault(),u=u.replace(":prevent","")),i=r.attr("_confirm"),i&&!window.confirm(i))return!1;switch(u){case"modal":return r.loadModal(),!1;case"action":return f=r.dataAttrs(),e=r.attr("href")||r.attr("action"),$ajax(e,f,r.attr("_data-type")||"JSON"),!1;case"checked":return function(){var t=r.dataAttrs(),n=[],i;r.parents(".data-list").find(".data-item input[type=checkbox]").each(function(){this.checked&&n.push(this.value)});n.length>0&&(t.id=n);i=r.attr("href")||r.attr("action");$ajax(i,t,r.attr("_data-type")||"JSON")}(),!1;case"checked:modal":case"modal:checked":return function(){var t={},n=[];r.parents(".data-list").find(".data-item input[type=checkbox]").each(function(){this.checked&&n.push(this.value)});n.length>0&&(t.id=n.join(","));r.loadModal(t)}(),!1}})});n("img[_error]",r).each(function(){var t=n(this).attr("_error");if(t)n(this).on("error",function(){this.src!==t&&(this.src=t)})});n("table thead .sorting",r).on("click",function(){var t=n(this),u="sorting-asc",f,i;t.hasClass("sorting-asc")?(t.dataAttr("desc","true"),u="sorting-desc"):t.dataAttr("desc","false");t.parent().find(".sorting").removeClass("sorting-asc").removeClass("sorting-desc");f=t.addClass(u).dataAttrs();i={};n(".toolbar form[method=get]",r).find("input,select,textarea").each(function(){this.value&&(i[this.name]=this.value.trim())});location.href=URL.toSearch(i,f)});n("form[method=get]",r).each(function(){n(this).find("input,select,textarea").each(function(){var n=this.name.toLowerCase(),t=n.indexOf(".");t>0&&(n=n.substr(t+1));this.name=n})});n(".navbar-nav",r).find(".menu-1,.menu-2,.menu-3").on("hidden.bs.collapse",function(t){t.stopPropagation();n(this).find('a[data-bs-toggle="collapse"]').addClass("collapsed").removeAttr("aria-expanded");n(this).find("div").removeClass("show")});n(".data-list",r).exec(function(n){var t=n.find(".checked-enabled"),i;if(t.length){i=n.find(".data-item input[type=checkbox]");n.find("input[type=checkbox]").on("click",function(){for(var n=0;n<i.length;n++)if(i[n].checked){t.enabled();return}t.disabled()})}}),function(t,i){t.split(",").forEach(function(t){return n("[_"+t+"-val]",i).exec(function(r){var u=n(r.attr("_"+t+"-val"),i);if(u.length)r.on("change",function(){u.attr(t,this.value)})})})}("min,max",r);n("input[type=date]",r).each(function(){var n=/(\d{4}[-/]\d{1,2}[-/]\d{1,2})/g.exec(this.value||this.defaultValue);n&&(this.value=n[0])});n("input[type=datetime-local]",r).each(function(){var n=/((\d{4}[-/]\d{1,2}[-/]\d{1,2}) (\d{1,2}:\d{1,2}:\d{1,2}))/g.exec(this.value||this.defaultValue);n&&(this.value=n[2]+"T"+n[3])})});window.$ajax=function(r,u,f,e,o){typeof u=="undefined"&&(u={});typeof f=="string"&&(o=f,f=undefined);typeof e=="string"&&(o=e,e=undefined);var s={url:r,data:u,type:"POST",headers:t(),success:function(n){f&&f(n)||showMsg(n,function(){location.href=n.data&&n.data.url?n.data.url:location.href})},error:function(n){i(n,e)}};return o?s.dataType=o:(s.contentType=!1,s.processData=!1),n.ajax(s),!1};window.URL||(window.URL={});URL.appendQuery=function(n,t){var i,r;return typeof n=="object"&&(t=n,n="?"),i=n.indexOf("?"),i!==-1?(r=n.substr(i+1),n=n.substr(0,i),t=URL.toSearch(r,t)):t=URL.toSearch(t),n+t};URL.toSearch=function(t,i){var r,u;typeof t=="string"&&(t=URL.parseQuery(t));t||(t={});i&&n.extend(t,i);i="";for(r in t)(u=t[r],u!=="")&&(i.length>0&&(i+="&"),i+=r,i+="=",i+=u);return"?"+i};URL.parseQuery=function(n){for(var u={},i=n.replace(/^\?/,"").split("&"),f=i.length,t=0,r;t<f;t++)i[t]&&(r=i[t].split("="),u[r[0]]=r[1]);return u};URL.parse=function(n){var t=document.createElement("a");return t.href=n,{source:n,protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,params:URL.parseQuery(t.search),file:(t.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:t.hash.replace("#",""),path:t.pathname.replace(/^([^\/])/,"/$1"),relative:(t.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:t.pathname.replace(/^\//,"").split("/")}};window.showMsg=function(t,i,r){if(typeof i=="function"?(r=i,i=-1):typeof i=="undefined"&&(i=-1),typeof t=="object"&&(i=t.code,t=t.message),t){var u=n(document.body).dset("gt-toast",function(){return n('<div style="z-index:100000;" data-bs-delay="1000" class="toast text-white position-fixed top-0 start-50 translate-middle-x"><div class="d-flex"><div class="toast-body"><\/div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"><\/button><\/div><\/div>').appendTo(document.body)});if(i?(t='<span class="bi-exclamation-circle"><\/span> '+t,u.removeClass("bg-success").addClass("bg-danger")):(t='<span class="bi-check-circle"><\/span> '+t,u.removeClass("bg-danger").addClass("bg-success")),u.off("hide.bs.toast").find(".toast-body").html(t),!i&&r)u.on("hide.bs.toast",function(){r()});u.toast("show")}};window.showAlert=function(t,i,r){var f;if(typeof i=="function"?(r=i,i=-1):typeof i=="undefined"&&(i=-1),typeof t=="object"&&(i=t.code,t=t.message),t){var u=n(document.body).dset("gt-alert",function(){return n('<div class="modal fade" data-bs-backdrop="static"><div class="modal-dialog alert-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-body"><div class="icon"><i><\/i><\/div> <div class="msg"><\/div><\/div><div class="modal-footer"><button type="button" class="btn btn-primary"> '+resources.alert.confirm+" <\/button><\/div><\/div><\/div><\/div>").appendTo(document.body)}),e=u.find(".modal-body"),o=i?"danger":"success",s=i?"bi-exclamation-circle":"bi-check-circle";if(e.attr("class","modal-body text-"+o).find("i").attr("class",s),e.find("div.msg").html(t),f=u.find("button").attr("class","btn btn-"+o),!i&&r)f.removeAttr("data-bs-dismiss").on("click",function(){typeof r=="function"?(r(u),u.modal("hide")):location.href=typeof r=="object"?r.url||location.href:location.href});else f.attr("data-bs-dismiss","modal").off("click");u.modal("show")}};n(function(){onrender()})})(jQuery);