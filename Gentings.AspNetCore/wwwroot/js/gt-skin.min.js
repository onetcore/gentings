"use strict";var resources={status:{404:"请求出错，网页地址不存在！",401:'很抱歉，你没有权限，如果没有登入可<a class="text-danger" href="/login?returnUrl='+location.href+'">点击登入...<\/a>'},unknownError:"很抱歉，出现了未知错误，请检查是否正确操作后请重试，如果多次出现问题请联系技术支持人员进行排查！",modal:{timeout:"服务器请求超时！",confirm:"确定"},ajax:{notFoundUrl:"操作地址没有配置，请检查a[href],form[action]值！",selectedFirst:"请选择项目后再进行操作！",noHeader:"没有配置RequestVerificationToken验证表单！",mustFormElement:"当前请求的元素必须为form表单元素！",uploading:"上传中..."},alert:{confirm:"确认"},elementError:"元素不存在或者操作一个元素实例，不能获取data-*相关数据！"};(function(n){function r(r){n("[_click]",r).each(function(){var u=n(this),f=u.attr("_click"),e=u.targetElement();if(f=="show"){u.on("click",function(n){n.stopPropagation();e.addClass("d-block");u.trigger("@show",e,n)});n(document).on("click",function(){e.removeClass("d-block");u.trigger("@hide",e,event)});e.on("click",function(n){n.stopPropagation()})}else if(f=="copy")u.on("click",function(t){t.preventDefault();n(document).on("copy",function(n){n.clipboardData.setData("text/plain",e.text().trim());n.preventDefault()});return document.execCommand("copy"),!1});else if(f=="upload")u.off("click").on("click",function(){return n('<input type="file" class="hide"/>').appendTo(document.body).on("change",function(){var f=n(this),e,r,o,s,h;if(this.files.length==0)return f.remove(),!1;e=u.html();u.disabled().html('<span class="spinner-border spinner-border-sm"><\/span> '+resources.ajax.uploading);r=new FormData;r.append("file",this.files[0]);o=u.dataAttrs();for(s in o)r.append(s,o[s]);h=u.attr("href")||u.attr("action");n.ajax({type:"POST",url:h,contentType:!1,processData:!1,data:r,headers:t(),success:function(t){showMsg(t);t.url&&(u.trigger("uploaded",t.url),u.parent().find(".uploaded").each(function(){var i=n(this);i.is("input")?i.val(t.url):i.is("img")&&i.attr("src",t.url)}));f.remove();u.enabled().html(e)},error:function(n){i(n);f.remove();u.enabled().html(e)}})}).click(),!1});else u.on("click",function(t){var i=f.indexOf(":stop"),e,o,s;if(i!=-1&&(t.stopPropagation(),f=f.replace(":stop","")),i=f.indexOf(":prevent"),i!=-1&&(t.preventDefault(),f=f.replace(":prevent","")),e=u.attr("_confirm"),e&&!window.confirm(e))return!1;switch(f){case"modal":return u.loadModal(),!1;case"action":return o=u.dataAttrs(),s=u.attr("href")||u.attr("action"),$ajax(s,o),!1;case"checked":return function(){var i=u.dataAttrs(),t=[],f;n(".data-item",r).find("input[type=checkbox]").each(function(){this.checked&&t.push(this.value)});t.length>0&&(i.id=t);f=u.attr("href")||u.attr("action");$ajax(f,i)}(),!1}})});window.hljs&&n("pre code",r).each(function(){hljs.highlightBlock(this)});n("img[_error]",r).each(function(){var t=this._error;if(t)n(this).on("error",function(){this.src!=t&&(this.src=t)})});n("table thead .sorting",r).on("click",function(){var t=n(this),u="sorting-asc",f,i;t.hasClass("sorting-asc")?(t.dataAttr("desc","true"),u="sorting-desc"):t.removeAttr("data-desc");t.parent().find(".sorting").removeClass("sorting-asc").removeClass("sorting-desc");f=t.addClass(u).dataAttrs();i={};n(".toolbar form[method=get]",r).find("input,select,textarea").each(function(){this.value&&(i[this.name]=this.value.trim())});location.href=URL.toSearch(i,f)});n("form[method=get]",r).each(function(){n(this).find("input,select,textarea").each(function(){var n=this.name.toLowerCase(),t=n.indexOf(".");t>0&&(n=n.substr(t+1));this.name=n})})}function t(){var t=n("#ajax-protected-form").find('[name="__RequestVerificationToken"]');if(t.length==0)throw new Error(resources.ajax.noHeader);return{RequestVerificationToken:t.val()}}function i(n,t){if(!t||!t(n)){var i=resources.status[n.status];if(i){showMsg(i);return}console.error(n.responseText);showMsg(resources.unknownError)}}n.fn.extend({dataAttr:function(n,t){return typeof t=="undefined"?this.attr("data-"+n):this.attr("data-"+n,t)},dataAttrs:function(){var i,n,t;if(this.length!=1)throw new Error(resources.elementError);for(i={},n=0;n<this[0].attributes.length;n++)t=this[0].attributes[n],t.name.startsWith("data-")&&(i[t.name.substr(5)]=t.value.trim());return i},targetElement:function(){var t=this.attr("_target");return t?t.startsWith(">")?t.find(t.substr(1).trim()):n(t):this},dset:function(n,t){var i=this.data(n);return i||(i=t(),this.data(n,i)),i},disabled:function(){return this.attr("disabled","disabled").addClass("disabled")},enabled:function(){return this.removeAttr("disabled").removeClass("disabled")},ajaxSubmit:function(r,u){if(!this.is("form"))throw Error(resources.ajax.mustFormElement);var f=this,o=new FormData(this[0]),e=f.find("[type=submit]").disabled();return n.ajax({type:"POST",url:f.attr("action")||location.href,contentType:!1,processData:!1,data:o,headers:t(),success:function(n){(e.removeAttr("disabled"),r&&r(n,f))||showMsg(n,function(){n.data&&n.data.url?location.href=n.data.url:n.code||(location.href=location.href)})},error:function(n){e.enabled();i(n,u)}}),!1},loadModal:function(){var u=this,t=this.dset("gt-modal",function(){return n('<div class="modal fade" data-bs-backdrop="static"><div>').appendTo(document.body).data("target",u.targetElement())}).empty(),i=this.attr("href")||this.attr("action"),f=this.dataAttrs();i=URL.appendQuery(i,f);t.load(i,function(n,u,f){var o,e;switch(u){case"error":o=resources.status[f.status];o||(o=resources.unknownError);showMsg(o);return;case"timeout":showMsg(resources.modal.timeout);return}e=t.find("form");e.length>0&&(e.attr("action")||e.attr("action",i),e.find("input[type=file]").length>0&&e.attr("enctype","multipart/form-data"),t.find("[type=submit]").click(function(){e.find(".field-validation-valid").hide();e.find(".modal-validation-summary").remove();e.ajaxSubmit(function(n,i){var r,u,f,e;if(n.code){if(n.data)for(r in n.data)u=i.find('[data-valmsg-for="'+r+'"]'),u.length==0&&(f=r.charAt(0),f>="a"&&f<="z"&&(e=f.toUpperCase()+r.substr(1),u=i.find('[data-valmsg-for="'+e+'"]'))),u.length&&u.html(n.data[r]).show();n.message&&i.prepend('<div class="alert alert-danger modal-validation-summary"><span class="bi-exclamation-circle"><\/span><span class="summary">'+n.message+"<\/span><\/div>")}else showAlert(n,function(){location.href=location.href}),t.modal("hide");return!0})}));r(t);t.modal("show");!t._onrendered&&window.onrendered&&(window.onrendered.call(t),t._onrendered=!0)})}});window.$ajax=function(r,u,f,e){n.ajax({url:r,data:u,dataType:"JSON",type:"POST",headers:t(),success:function(n){f&&f(n.data)||showMsg(n,function(){location.href=n.data&&n.data.url?n.data.url:location.href})},error:function(n){e?e(n):i(n)}})};window.URL||(window.URL={});URL.appendQuery=function(n,t){var i,r;return typeof n=="object"&&(t=n,n="?"),i=n.indexOf("?"),i!=-1?(r=n.substr(i+1),n=n.substr(0,i),t=URL.toSearch(r,t)):t=URL.toSearch(t),n+t};URL.toSearch=function(n,t){var i,r;if(typeof n=="string"&&(n=URL.parseQuery(n)),n||(n={}),t)for(i in t)n[i]=t[i];t="";for(i in n)(r=n[i],r!="")&&(t.length>0&&(t+="&"),t+=i,t+="=",t+=r);return"?"+t};URL.parseQuery=function(n){for(var u={},i=n.replace(/^\?/,"").split("&"),f=i.length,t=0,r;t<f;t++)i[t]&&(r=i[t].split("="),u[r[0]]=r[1]);return u};URL.parse=function(n){var t=document.createElement("a");return t.href=n,{source:n,protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,params:URL.parseQuery(t.search),file:(t.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:t.hash.replace("#",""),path:t.pathname.replace(/^([^\/])/,"/$1"),relative:(t.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:t.pathname.replace(/^\//,"").split("/")}};window.showMsg=function(t,i,r){if(typeof i=="function"?(r=i,i=-1):typeof i=="undefined"&&(i=-1),typeof t=="object"&&(i=t.code,t=t.message),t){var u=n(document.body).dset("gt-toast",function(){return n('<div style="z-index:100000;" class="toast text-white position-fixed top-0 start-50 translate-middle-x"><div class="d-flex"><div class="toast-body"><\/div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"><\/button><\/div><\/div>').appendTo(document.body)});if(i?(t='<span class="bi-exclamation-circle"><\/span> '+t,u.removeClass("bg-success").addClass("bg-danger")):(t='<span class="bi-check-circle"><\/span> '+t,u.removeClass("bg-danger").addClass("bg-success")),u.off("hide.bs.toast").find(".toast-body").html(t),!i&&r)u.on("hide.bs.toast",function(){r()});u.toast("show")}};window.showAlert=function(t,i,r){var f;if(typeof i=="function"?(r=i,i=-1):typeof i=="undefined"&&(i=-1),typeof t=="object"&&(i=t.code,t=t.message),t){var u=n(document.body).dset("gt-alert",function(){return n('<div class="modal fade" data-bs-backdrop="static"><div class="modal-dialog alert-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-body"><div class="icon"><i><\/i><\/div> <div class="msg"><\/div><\/div><div class="modal-footer"><button type="button" class="btn btn-primary"> '+resources.alert.confirm+" <\/button><\/div><\/div><\/div><\/div>").appendTo(document.body)}),e=u.find(".modal-body"),o=i?"danger":"success",s=i?"bi-exclamation-circle":"bi-check-circle";if(e.attr("class","modal-body text-"+o).find("i").attr("class",s),e.find("div.msg").html(t),f=u.find("button").attr("class","btn btn-"+o),!i&&r)f.removeAttr("data-bs-dismiss").on("click",function(){typeof r=="function"?(r(u),u.modal("hide")):location.href=typeof r=="object"?r.url||location.href:location.href});else f.attr("data-bs-dismiss","modal").off("click");u.modal("show")}};n(function(){r()})})(jQuery);